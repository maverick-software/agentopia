# WordPress Service Provider Configuration Design Research

## Research Overview
This document analyzes how to configure WordPress as a service provider in Agentopia's database, examining existing patterns and designing the WordPress-specific configuration.

## Existing Service Provider Patterns Analysis

### 1. API Key Based Providers (Similar to WordPress)

#### ClickSend SMS Example
From `supabase/migrations/20250913120002_add_clicksend_service_provider.sql`:

```sql
INSERT INTO service_providers (
    name,
    display_name,
    authorization_endpoint,
    token_endpoint,
    scopes_supported,
    pkce_required,
    is_enabled,
    configuration_metadata
) VALUES (
    'clicksend_sms',
    'ClickSend SMS',
    'https://rest.clicksend.com/v3/oauth/authorize', -- Placeholder for API key auth
    'https://rest.clicksend.com/v3/oauth/token',     -- Placeholder for API key auth
    '["sms", "mms", "balance", "history", "delivery_receipts"]'::jsonb,
    false, -- API key based, no PKCE
    true,
    '{
        "authentication_type": "basic_auth",
        "api_base_url": "https://rest.clicksend.com/v3",
        "auth_header_format": "Basic {base64(username:api_key)}",
        "supported_message_types": ["sms", "mms"],
        "features": { ... },
        "limits": { ... },
        "documentation_url": "https://developers.clicksend.com/"
    }'::jsonb
);
```

#### Mistral AI OCR Example
From `supabase/migrations/20250109000001_add_mistral_ocr_integration.sql`:

```sql
INSERT INTO service_providers (
  name,
  display_name,
  authorization_endpoint,
  token_endpoint,
  scopes_supported,
  pkce_required,
  is_enabled,
  configuration_metadata
) VALUES (
  'mistral_ai',
  'Mistral AI',
  'https://api.mistral.ai/v1/oauth/authorize', -- Placeholder for API key auth
  'https://api.mistral.ai/v1/oauth/token',     -- Placeholder for API key auth
  '["ocr", "document_processing"]'::jsonb,
  false, -- API key based, no PKCE
  true,
  '{
    "api_base_url": "https://api.mistral.ai/v1",
    "authentication_type": "api_key",
    "header_format": "Bearer {api_key}",
    "supported_formats": ["pdf", "png", "jpg", ...],
    "max_file_size_mb": 20,
    "features": { ... }
  }'::jsonb
);
```

### 2. Key Configuration Patterns

#### Common Fields for API Key Providers
1. **Placeholder OAuth URLs**: Even API key providers have placeholder OAuth endpoints
2. **Authentication Type**: Specified in `configuration_metadata`
3. **API Base URL**: Base endpoint for API calls
4. **Header Format**: How to format authentication headers
5. **Features**: Capabilities and limitations
6. **Documentation**: Links to provider documentation

## WordPress Service Provider Design

### 1. WordPress Provider Configuration

Based on the analysis, here's the WordPress service provider configuration:

```sql
INSERT INTO service_providers (
    name,
    display_name,
    authorization_endpoint,
    token_endpoint,
    revoke_endpoint,
    discovery_endpoint,
    scopes_supported,
    pkce_required,
    client_credentials_location,
    is_enabled,
    configuration_metadata
) VALUES (
    'wordpress',
    'WordPress',
    '', -- Not applicable for Application Passwords
    '', -- Not applicable for Application Passwords  
    null,
    null,
    '["read", "write", "delete", "manage_options", "manage_users", "manage_plugins", "manage_themes"]'::jsonb,
    false, -- Application Passwords don't use PKCE
    'header',
    true,
    '{
        "authentication_type": "application_password",
        "api_base_path": "/wp-json/wp/v2",
        "auth_header_format": "Basic {base64(username:app_password)}",
        "required_wp_version": "5.6.0",
        "https_required": true,
        "supported_endpoints": {
            "posts": "/posts",
            "pages": "/pages", 
            "media": "/media",
            "comments": "/comments",
            "users": "/users",
            "categories": "/categories",
            "tags": "/tags",
            "settings": "/settings",
            "plugins": "/plugins",
            "themes": "/themes"
        },
        "capabilities": {
            "read": {
                "description": "Read posts, pages, and other content",
                "endpoints": ["posts", "pages", "media", "comments", "categories", "tags"]
            },
            "write": {
                "description": "Create and update content",
                "endpoints": ["posts", "pages", "media", "comments"]
            },
            "delete": {
                "description": "Delete content",
                "endpoints": ["posts", "pages", "media", "comments"]
            },
            "manage_options": {
                "description": "Manage site settings",
                "endpoints": ["settings"]
            },
            "manage_users": {
                "description": "Manage users and profiles",
                "endpoints": ["users"]
            },
            "manage_plugins": {
                "description": "Manage plugins",
                "endpoints": ["plugins"]
            },
            "manage_themes": {
                "description": "Manage themes",
                "endpoints": ["themes"]
            }
        },
        "features": {
            "content_management": true,
            "media_upload": true,
            "user_management": true,
            "comment_moderation": true,
            "taxonomy_management": true,
            "settings_management": true,
            "plugin_management": true,
            "theme_management": true,
            "custom_post_types": true,
            "custom_fields": true,
            "multisite_support": false
        },
        "limits": {
            "max_file_size_mb": 100,
            "rate_limit_per_minute": 60,
            "concurrent_requests": 5,
            "max_posts_per_request": 100
        },
        "security": {
            "https_required": true,
            "application_passwords_required": true,
            "min_wp_version": "5.6.0"
        },
        "documentation_url": "https://developer.wordpress.org/rest-api/",
        "setup_instructions": {
            "step_1": "Ensure WordPress version 5.6 or higher",
            "step_2": "Navigate to Users > Profile in WordPress admin",
            "step_3": "Scroll to Application Passwords section",
            "step_4": "Create new application password",
            "step_5": "Enter site URL, username, and application password in Agentopia"
        },
        "integration_description": "Connect to WordPress sites to manage content, users, and settings through the WordPress REST API. Supports posts, pages, media, comments, and administrative functions.",
        "icon_name": "Globe",
        "is_popular": true,
        "provider_type": "api_key",
        "connection_validation": {
            "test_endpoint": "/users/me",
            "required_response_fields": ["id", "name", "capabilities"],
            "timeout_seconds": 10
        }
    }'::jsonb
);
```

### 2. WordPress-Specific Configuration Elements

#### Authentication Configuration
```json
{
    "authentication_type": "application_password",
    "auth_header_format": "Basic {base64(username:app_password)}",
    "https_required": true,
    "required_wp_version": "5.6.0"
}
```

#### API Endpoint Mapping
```json
{
    "supported_endpoints": {
        "posts": "/posts",
        "pages": "/pages",
        "media": "/media",
        "comments": "/comments",
        "users": "/users",
        "categories": "/categories",
        "tags": "/tags",
        "settings": "/settings"
    }
}
```

#### Capability-Based Permissions
```json
{
    "capabilities": {
        "read": {
            "description": "Read posts, pages, and other content",
            "endpoints": ["posts", "pages", "media", "comments"]
        },
        "write": {
            "description": "Create and update content", 
            "endpoints": ["posts", "pages", "media"]
        }
    }
}
```

### 3. Connection Metadata Structure

When users connect to WordPress sites, the connection metadata will include:

```json
{
    "site_url": "https://example.com",
    "site_name": "Example WordPress Site",
    "wp_version": "6.4.2",
    "api_base_url": "https://example.com/wp-json/wp/v2",
    "username": "admin",
    "user_id": 1,
    "user_roles": ["administrator"],
    "user_capabilities": {
        "read": true,
        "write": true,
        "delete_posts": true,
        "manage_options": true,
        "manage_users": true
    },
    "site_info": {
        "name": "Example Site",
        "description": "Just another WordPress site",
        "timezone": "America/New_York",
        "date_format": "F j, Y",
        "time_format": "g:i a"
    },
    "available_endpoints": [
        "posts", "pages", "media", "comments", 
        "users", "categories", "tags", "settings"
    ],
    "connection_method": "application_password",
    "last_verified": "2025-09-14T10:30:00Z",
    "connection_test_results": {
        "api_accessible": true,
        "authentication_valid": true,
        "ssl_valid": true,
        "response_time_ms": 245
    }
}
```

## Integration with Existing Architecture

### 1. Follows Established Patterns
- **Placeholder OAuth URLs**: Consistent with other API key providers
- **Configuration Metadata**: Rich JSON configuration following existing patterns
- **Scopes**: WordPress capabilities mapped to Agentopia scopes
- **Features Object**: Detailed capability description

### 2. WordPress-Specific Enhancements
- **Site URL Flexibility**: Each connection can be to different WordPress sites
- **Capability Detection**: Dynamic capability discovery per connection
- **Version Validation**: Ensures WordPress version compatibility
- **HTTPS Enforcement**: Security requirement for Application Passwords

### 3. Extensibility Considerations
- **OAuth Support**: Configuration ready for future OAuth implementation
- **Custom Endpoints**: Support for custom WordPress endpoints
- **Multisite**: Framework for future multisite support
- **Plugin Integration**: Extensible for WordPress plugin-specific endpoints

## Database Migration Implementation

### 1. Migration File Structure
```sql
-- Migration: Add WordPress Integration
-- Purpose: Add WordPress as a service provider for REST API integration
-- Date: [Current Date]

BEGIN;

-- Step 1: Add WordPress as a service provider
INSERT INTO service_providers (
    -- Configuration as defined above
) ON CONFLICT (name) DO UPDATE SET
    display_name = EXCLUDED.display_name,
    configuration_metadata = EXCLUDED.configuration_metadata,
    updated_at = now();

-- Step 2: Add helpful comment
COMMENT ON TABLE service_providers IS 'Service providers for OAuth and API key integrations including WordPress REST API';

COMMIT;
```

### 2. Rollback Strategy
```sql
-- Rollback: Remove WordPress integration
DELETE FROM service_providers WHERE name = 'wordpress';
```

## Validation and Testing

### 1. Configuration Validation
- Verify JSON structure is valid
- Test all endpoint mappings
- Validate capability definitions
- Check documentation URLs

### 2. Integration Testing
- Test service provider creation
- Verify configuration retrieval
- Test connection establishment
- Validate capability mapping

## Alignment with Agentopia Architecture

### 1. Consistency with Existing Providers
- **Naming Convention**: Follows `provider_name` pattern
- **JSON Structure**: Consistent with other providers
- **Feature Flags**: Similar to other integrations
- **Documentation**: Standard documentation structure

### 2. Security Compliance
- **HTTPS Requirement**: Enforced in configuration
- **Capability Scoping**: Granular permission control
- **Version Requirements**: Minimum version enforcement
- **Validation Rules**: Connection testing requirements

### 3. Future Compatibility
- **OAuth Ready**: Configuration supports future OAuth implementation
- **Extensible**: Easy to add new capabilities and endpoints
- **Scalable**: Supports multiple WordPress site connections
- **Maintainable**: Clear configuration structure

## Conclusion

The WordPress service provider configuration follows Agentopia's established patterns while providing WordPress-specific functionality:

1. **Standard Structure**: Uses existing service provider table without modifications
2. **Rich Configuration**: Comprehensive metadata for WordPress-specific features
3. **Security Focus**: HTTPS and version requirements enforced
4. **Extensible Design**: Ready for future enhancements and custom endpoints
5. **Capability Mapping**: WordPress capabilities mapped to Agentopia permissions

This design ensures seamless integration with existing Agentopia architecture while providing comprehensive WordPress REST API support.
