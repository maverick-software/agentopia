# Microsoft Graph API Calendar Operations Research

**Date:** September 10, 2025  
**Research Item:** WBS 1.1 - Microsoft Graph API Research - Calendar Operations  
**Purpose:** Research Microsoft Graph API endpoints and patterns for calendar operations  

## Microsoft Graph API Calendar Endpoints

### Base URL and Authentication
- **Base URL:** `https://graph.microsoft.com/v1.0/`
- **Authentication:** Bearer token from OAuth 2.0 flow
- **Required Headers:**
  - `Authorization: Bearer {access_token}`
  - `Content-Type: application/json`

### Key Calendar Endpoints

#### 1. Create Calendar Event
- **Endpoint:** `POST /me/events`
- **Purpose:** Create a new calendar event
- **Payload Structure:**
```json
{
  "subject": "Team Meeting",
  "body": {
    "contentType": "HTML",
    "content": "Discuss project progress and next steps."
  },
  "start": {
    "dateTime": "2025-09-15T14:00:00.000Z",
    "timeZone": "UTC"
  },
  "end": {
    "dateTime": "2025-09-15T15:00:00.000Z", 
    "timeZone": "UTC"
  },
  "location": {
    "displayName": "Conference Room A",
    "address": {
      "street": "123 Main St",
      "city": "Seattle",
      "state": "WA",
      "countryOrRegion": "US",
      "postalCode": "98052"
    }
  },
  "attendees": [
    {
      "emailAddress": {
        "address": "attendee@example.com",
        "name": "John Doe"
      },
      "type": "required"
    }
  ],
  "allowNewTimeProposals": true,
  "categories": ["Red category"],
  "importance": "normal",
  "isReminderOn": true,
  "reminderMinutesBeforeStart": 15,
  "responseRequested": true,
  "sensitivity": "normal",
  "showAs": "busy"
}
```

#### 2. List Calendar Events
- **Endpoint:** `GET /me/events`
- **Purpose:** Get user's calendar events
- **Query Parameters:**
  - `$top`: Number of events to return (default: 10, max: 999)
  - `$skip`: Number of events to skip
  - `$filter`: Filter criteria (e.g., by date range)
  - `$select`: Specific properties to return
  - `$orderby`: Sort order
- **Example:** `GET /me/events?$top=25&$select=subject,start,end,organizer&$orderby=start/dateTime`

#### 3. Get Specific Event
- **Endpoint:** `GET /me/events/{event-id}`
- **Purpose:** Get details of a specific calendar event
- **Example:** `GET /me/events/AAMkAGVmMDEzMTM4LTZmYWUtNDdkNC1hMDZiLTU1OGY5OTZhYmY4OABGAAAAAAAiQ8W967B7TKBjgx9rVEURBwAiIsqMbYjsT5e-T7KzowPTAAAAAAEMAAAiIsqMbYjsT5e-T7KzowPTAAAYNUm3AAA%3D`

#### 4. Update Calendar Event
- **Endpoint:** `PATCH /me/events/{event-id}`
- **Purpose:** Update an existing calendar event
- **Payload:** (Same structure as create, but only include fields to update)
```json
{
  "subject": "Updated Team Meeting",
  "start": {
    "dateTime": "2025-09-15T15:00:00.000Z",
    "timeZone": "UTC"
  },
  "end": {
    "dateTime": "2025-09-15T16:00:00.000Z",
    "timeZone": "UTC"
  }
}
```

#### 5. Delete Calendar Event
- **Endpoint:** `DELETE /me/events/{event-id}`
- **Purpose:** Delete a calendar event

#### 6. Get Events in Date Range
- **Endpoint:** `GET /me/events?$filter=start/dateTime ge '2025-09-01T00:00:00.000Z' and end/dateTime le '2025-09-30T23:59:59.999Z'`
- **Purpose:** Get events within a specific date range

#### 7. Get Free/Busy Information
- **Endpoint:** `POST /me/calendar/getSchedule`
- **Purpose:** Get free/busy information for attendees
- **Payload:**
```json
{
  "schedules": [
    "attendee1@example.com",
    "attendee2@example.com"
  ],
  "startTime": {
    "dateTime": "2025-09-15T09:00:00.000Z",
    "timeZone": "UTC"
  },
  "endTime": {
    "dateTime": "2025-09-15T18:00:00.000Z",
    "timeZone": "UTC"
  },
  "availabilityViewInterval": 60
}
```

### Event Properties Reference

#### Core Properties
- **subject:** Event title/subject
- **body:** Event description with content type (Text/HTML)
- **start/end:** Date/time with timezone
- **location:** Meeting location details
- **attendees:** List of attendees with email and type

#### Advanced Properties
- **categories:** Color categories for organization
- **importance:** normal, low, high
- **sensitivity:** normal, personal, private, confidential
- **showAs:** free, tentative, busy, oof, workingElsewhere, unknown
- **isAllDay:** Boolean for all-day events
- **recurrence:** Recurrence pattern for repeating events
- **reminderMinutesBeforeStart:** Reminder timing
- **responseRequested:** Whether responses are requested

### Recurrence Patterns

#### Daily Recurrence
```json
{
  "recurrence": {
    "pattern": {
      "type": "daily",
      "interval": 1
    },
    "range": {
      "type": "endDate",
      "startDate": "2025-09-15",
      "endDate": "2025-12-15"
    }
  }
}
```

#### Weekly Recurrence
```json
{
  "recurrence": {
    "pattern": {
      "type": "weekly",
      "interval": 1,
      "daysOfWeek": ["monday", "wednesday", "friday"]
    },
    "range": {
      "type": "numbered",
      "startDate": "2025-09-15",
      "numberOfOccurrences": 10
    }
  }
}
```

### Required OAuth Scopes for Calendar Operations

#### Minimum Scopes
- `Calendars.Read` - Read user's calendars and events
- `Calendars.ReadWrite` - Read and modify user's calendars and events
- `Calendars.ReadWrite.Shared` - Read and write shared calendars
- `User.Read` - Read user profile information

#### Scope Descriptions
- **Calendars.Read:** Read-only access to user's calendar events
- **Calendars.ReadWrite:** Full access to create, read, update, delete events
- **Calendars.ReadBasic:** Read basic calendar properties only
- **Calendars.ReadWrite.Shared:** Access to shared calendars

## Time Zone Handling

### Best Practices
1. **Always specify timezone:** Include timeZone property in start/end objects
2. **Use IANA timezone names:** e.g., "America/New_York", "Europe/London"
3. **UTC for storage:** Convert to UTC for database storage
4. **User's timezone for display:** Convert to user's local timezone for UI

### Common Timezone Formats
```json
{
  "start": {
    "dateTime": "2025-09-15T14:00:00.000Z",
    "timeZone": "UTC"
  }
}
```

```json
{
  "start": {
    "dateTime": "2025-09-15T09:00:00.000",
    "timeZone": "America/New_York"
  }
}
```

## Error Handling Patterns

### Common Calendar-Specific Errors
- **ConflictingEvent:** Event conflicts with existing event
- **InvalidTimeZone:** Invalid timezone specification
- **InvalidRecurrence:** Invalid recurrence pattern
- **AttendeeNotFound:** Specified attendee doesn't exist
- **CalendarNotFound:** Target calendar doesn't exist

### Error Response Example
```json
{
  "error": {
    "code": "ConflictingEvent",
    "message": "The event conflicts with another event in the calendar.",
    "innerError": {
      "date": "2025-09-10T10:30:00",
      "request-id": "request-id-guid"
    }
  }
}
```

## Implementation Considerations

### Date/Time Handling
1. **ISO 8601 Format:** Use proper ISO 8601 datetime strings
2. **Timezone Awareness:** Always handle timezones explicitly
3. **All-Day Events:** Use date-only format for all-day events
4. **Duration Calculation:** Validate start < end times

### Attendee Management
1. **Email Validation:** Validate attendee email addresses
2. **Optional vs Required:** Specify attendee type correctly
3. **Response Tracking:** Handle attendee responses appropriately
4. **External Attendees:** Handle attendees outside organization

### Performance Optimization
1. **Batch Operations:** Use `$batch` for multiple operations
2. **Selective Properties:** Use `$select` to reduce payload size
3. **Date Range Filtering:** Use `$filter` for date ranges
4. **Pagination:** Implement proper pagination for large calendars

## Integration with Existing Patterns

### Tool Implementation Strategy
- **Tool Names:** `outlook_create_event`, `outlook_get_events`, `outlook_update_event`
- **Parameter Mapping:** Convert agent parameters to Graph API format
- **Response Formatting:** Format Graph API responses for agent consumption
- **Error Handling:** Convert Graph API errors to LLM-friendly messages

### LLM-Friendly Error Examples
```typescript
// Instead of: "InvalidTimeZone: The time zone 'EST' is not recognized"
// Return: "Question: What timezone should I use for this event? Please provide a valid timezone like 'America/New_York' or 'UTC'."

// Instead of: "ConflictingEvent: Event conflicts with existing event"
// Return: "Question: This time slot conflicts with another event. Would you like me to suggest alternative times or should I create the event anyway?"
```

## Next Steps for Implementation
1. Create calendar-specific utility functions
2. Implement proper timezone handling
3. Add recurrence pattern support
4. Test with various event types and scenarios
5. Integrate with Universal Tool Executor routing
