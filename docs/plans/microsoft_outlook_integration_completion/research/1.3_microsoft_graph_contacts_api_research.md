# Microsoft Graph API Contacts Operations Research

**Date:** September 10, 2025  
**Research Item:** WBS 1.1 - Microsoft Graph API Research - Contacts Operations  
**Purpose:** Research Microsoft Graph API endpoints and patterns for contacts operations  

## Microsoft Graph API Contacts Endpoints

### Base URL and Authentication
- **Base URL:** `https://graph.microsoft.com/v1.0/`
- **Authentication:** Bearer token from OAuth 2.0 flow
- **Required Headers:**
  - `Authorization: Bearer {access_token}`
  - `Content-Type: application/json`

### Key Contacts Endpoints

#### 1. List Contacts
- **Endpoint:** `GET /me/contacts`
- **Purpose:** Get user's contacts
- **Query Parameters:**
  - `$top`: Number of contacts to return (default: 10, max: 999)
  - `$skip`: Number of contacts to skip
  - `$filter`: Filter criteria
  - `$select`: Specific properties to return
  - `$orderby`: Sort order
  - `$search`: Search contacts by name or email
- **Example:** `GET /me/contacts?$top=50&$select=displayName,emailAddresses,phoneNumbers&$orderby=displayName`

#### 2. Get Specific Contact
- **Endpoint:** `GET /me/contacts/{contact-id}`
- **Purpose:** Get details of a specific contact
- **Example:** `GET /me/contacts/AAMkAGVmMDEzMTM4LTZmYWUtNDdkNC1hMDZiLTU1OGY5OTZhYmY4OABGAAAAAAAiQ8W967B7TKBjgx9rVEURBwAiIsqMbYjsT5e-T7KzowPTAAAAAAEMAAAiIsqMbYjsT5e-T7KzowPTAAAYNUm3AAA%3D`

#### 3. Create Contact
- **Endpoint:** `POST /me/contacts`
- **Purpose:** Create a new contact
- **Payload Structure:**
```json
{
  "displayName": "John Doe",
  "givenName": "John",
  "surname": "Doe",
  "emailAddresses": [
    {
      "address": "john.doe@example.com",
      "name": "John Doe"
    }
  ],
  "phoneNumbers": [
    {
      "number": "+1 555-123-4567",
      "type": "mobile"
    },
    {
      "number": "+1 555-987-6543",
      "type": "business"
    }
  ],
  "businessAddress": {
    "street": "123 Business St",
    "city": "Seattle",
    "state": "WA",
    "countryOrRegion": "USA",
    "postalCode": "98052"
  },
  "homeAddress": {
    "street": "456 Home Ave",
    "city": "Redmond",
    "state": "WA",
    "countryOrRegion": "USA",
    "postalCode": "98053"
  },
  "companyName": "Contoso Corporation",
  "jobTitle": "Software Engineer",
  "department": "Engineering",
  "businessHomePage": "https://www.contoso.com",
  "personalNotes": "Met at the conference in 2025"
}
```

#### 4. Update Contact
- **Endpoint:** `PATCH /me/contacts/{contact-id}`
- **Purpose:** Update an existing contact
- **Payload:** (Same structure as create, but only include fields to update)
```json
{
  "jobTitle": "Senior Software Engineer",
  "phoneNumbers": [
    {
      "number": "+1 555-123-4567",
      "type": "mobile"
    },
    {
      "number": "+1 555-111-2222",
      "type": "business"
    }
  ]
}
```

#### 5. Delete Contact
- **Endpoint:** `DELETE /me/contacts/{contact-id}`
- **Purpose:** Delete a contact

#### 6. Search Contacts
- **Endpoint:** `GET /me/contacts?$search="search query"`
- **Purpose:** Search contacts by name, email, or other properties
- **Example:** `GET /me/contacts?$search="john"`

#### 7. Get Contact Folders
- **Endpoint:** `GET /me/contactFolders`
- **Purpose:** Get contact folders for organization
- **Example:** `GET /me/contactFolders?$select=displayName,id`

### Contact Properties Reference

#### Core Properties
- **displayName:** Full display name
- **givenName:** First name
- **surname:** Last name
- **middleName:** Middle name
- **nickName:** Nickname
- **title:** Title (Mr., Ms., Dr., etc.)

#### Contact Information
- **emailAddresses:** Array of email addresses with names
- **phoneNumbers:** Array of phone numbers with types
- **imAddresses:** Instant messaging addresses
- **businessHomePage:** Company website URL

#### Address Information
- **businessAddress:** Business address object
- **homeAddress:** Home address object
- **otherAddress:** Other address object

#### Professional Information
- **companyName:** Company name
- **jobTitle:** Job title
- **department:** Department
- **officeLocation:** Office location
- **profession:** Profession
- **manager:** Manager name

#### Personal Information
- **birthday:** Birthday date
- **personalNotes:** Personal notes
- **spouseName:** Spouse name
- **children:** Array of children names

#### Additional Properties
- **categories:** Array of categories for organization
- **flag:** Follow-up flag information
- **createdDateTime:** When contact was created
- **lastModifiedDateTime:** When contact was last modified

### Address Object Structure
```json
{
  "street": "123 Main Street",
  "city": "Seattle",
  "state": "WA",
  "countryOrRegion": "USA",
  "postalCode": "98052"
}
```

### Email Address Object Structure
```json
{
  "address": "john.doe@example.com",
  "name": "John Doe"
}
```

### Phone Number Object Structure
```json
{
  "number": "+1 555-123-4567",
  "type": "mobile" // mobile, business, home, other, assistant, homeFax, businessFax, otherFax, pager, radio
}
```

### Required OAuth Scopes for Contacts Operations

#### Minimum Scopes
- `Contacts.Read` - Read user's contacts
- `Contacts.ReadWrite` - Read and modify user's contacts
- `User.Read` - Read user profile information

#### Scope Descriptions
- **Contacts.Read:** Read-only access to user's contacts
- **Contacts.ReadWrite:** Full access to create, read, update, delete contacts
- **Contacts.ReadBasic:** Read basic contact properties only

## Search and Filtering

### Search Capabilities
- **$search:** Full-text search across multiple properties
- **Searchable Properties:** displayName, givenName, surname, emailAddresses, companyName

### Filter Examples
```
GET /me/contacts?$filter=startswith(displayName,'John')
GET /me/contacts?$filter=companyName eq 'Microsoft'
GET /me/contacts?$filter=emailAddresses/any(e:e/address eq 'john@example.com')
```

### Sorting Options
```
GET /me/contacts?$orderby=displayName
GET /me/contacts?$orderby=surname,givenName
GET /me/contacts?$orderby=createdDateTime desc
```

## Error Handling Patterns

### Common Contacts-Specific Errors
- **ContactNotFound:** Contact with specified ID doesn't exist
- **DuplicateContact:** Attempting to create duplicate contact
- **InvalidEmailAddress:** Invalid email address format
- **InvalidPhoneNumber:** Invalid phone number format
- **ContactFolderNotFound:** Specified contact folder doesn't exist

### Error Response Example
```json
{
  "error": {
    "code": "ContactNotFound",
    "message": "The contact with the specified ID was not found.",
    "innerError": {
      "date": "2025-09-10T10:30:00",
      "request-id": "request-id-guid"
    }
  }
}
```

## Implementation Considerations

### Data Validation
1. **Email Validation:** Validate email address format
2. **Phone Number Formatting:** Standardize phone number formats
3. **Required Fields:** Ensure displayName is provided
4. **Address Validation:** Validate address components

### Contact Management
1. **Duplicate Detection:** Check for existing contacts before creating
2. **Merge Contacts:** Handle duplicate contacts appropriately
3. **Contact Categories:** Use categories for organization
4. **Contact Photos:** Handle contact photo uploads/downloads

### Performance Optimization
1. **Selective Properties:** Use `$select` to reduce payload size
2. **Pagination:** Implement proper pagination for large contact lists
3. **Search Optimization:** Use appropriate search and filter parameters
4. **Batch Operations:** Use `$batch` for multiple operations

## Integration with Existing Patterns

### Tool Implementation Strategy
- **Tool Names:** `outlook_get_contacts`, `outlook_create_contact`, `outlook_update_contact`, `outlook_search_contacts`
- **Parameter Mapping:** Convert agent parameters to Graph API format
- **Response Formatting:** Format Graph API responses for agent consumption
- **Error Handling:** Convert Graph API errors to LLM-friendly messages

### LLM-Friendly Error Examples
```typescript
// Instead of: "ContactNotFound: The contact with ID 'xyz' was not found"
// Return: "Question: I couldn't find that contact. Could you provide the contact's name or email address instead?"

// Instead of: "InvalidEmailAddress: The email address format is invalid"
// Return: "Question: The email address format seems incorrect. Please provide a valid email address like 'name@example.com'."

// Instead of: "DuplicateContact: A contact with this email already exists"
// Return: "Question: A contact with this email already exists. Would you like me to update the existing contact or create a new one with a different email?"
```

### Contact Search Implementation
```typescript
// Support natural language queries
// "Find contacts from Microsoft" -> filter by companyName
// "Find John's contact" -> search by displayName
// "Find contacts with gmail addresses" -> filter by email domain
```

## Privacy and Security Considerations

### Data Privacy
1. **Sensitive Information:** Handle personal information appropriately
2. **Data Retention:** Follow data retention policies
3. **Access Logging:** Log contact access for audit purposes
4. **User Consent:** Ensure proper user consent for contact access

### Security Best Practices
1. **Input Sanitization:** Sanitize all user input
2. **Output Encoding:** Encode contact data for display
3. **Rate Limiting:** Implement appropriate rate limiting
4. **Scope Validation:** Verify user has required scopes

## Next Steps for Implementation
1. Create contacts-specific utility functions
2. Implement search and filtering capabilities
3. Add proper data validation and sanitization
4. Test with various contact scenarios
5. Integrate with Universal Tool Executor routing
6. Implement privacy and security measures
